<?xml version="1.0" encoding="UTF-8"?>
<!--
 * See the NOTICE file distributed with this work for additional
 * information regarding copyright ownership.
 *
 * This is free software; you can redistribute it and/or modify it
 * under the terms of the GNU Lesser General Public License as
 * published by the Free Software Foundation; either version 2.1 of
 * the License, or (at your option) any later version.
 *
 * This software is distributed in the hope that it will be useful,
 * but WITHOUT ANY WARRANTY; without even the implied warranty of
 * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the GNU
 * Lesser General Public License for more details.
 *
 * You should have received a copy of the GNU Lesser General Public
 * License along with this software; if not, write to the Free
 * Software Foundation, Inc., 51 Franklin St, Fifth Floor, Boston, MA
 * 02110-1301 USA, or see the FSF site: http://www.fsf.org.
-->
<project xmlns="http://maven.apache.org/POM/4.0.0" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xsi:schemaLocation="http://maven.apache.org/POM/4.0.0 http://maven.apache.org/maven-v4_0_0.xsd">
  <modelVersion>4.0.0</modelVersion>
  <parent>
    <groupId>org.xwiki.platform</groupId>
    <artifactId>xwiki-platform-distribution</artifactId>
    <version>9.5-SNAPSHOT</version>
    <!-- Note: Do not modify the <relativePath> tag here as this can cause issues. See the pom.xml for xwiki-platform
         for more details. By using an empty value we force Maven to resolve the parent from the Maven repositories,
         see http://maven.apache.org/ref/3.2.3/maven-model/maven.html#class_parent -->
    <relativePath />
  </parent>
  <groupId>org.xwiki.enterprise</groupId>
  <artifactId>xwiki-enterprise</artifactId>
  <version>9.5-SNAPSHOT</version>
  <packaging>pom</packaging>
  <name>XWiki Enterprise - Parent POM</name>
  <description>XWiki Enterprise - Parent POM</description>
  <scm>
    <connection>scm:git:git://github.com/xwiki/xwiki-enterprise.git</connection>
    <developerConnection>scm:git:git@github.com:xwiki/xwiki-enterprise.git</developerConnection>
    <url>http://github.com/xwiki/xwiki-enterprise/tree/master/</url>
    <tag>HEAD</tag>
  </scm>
  <issueManagement>
    <system>jira</system>
    <url>https://jira.xwiki.org/browse/XE</url>
  </issueManagement>
  <modules>
    <!-- Sorted Alphabetically -->
    <module>xwiki-enterprise-data</module>
    <module>xwiki-enterprise-distribution</module>
    <module>xwiki-enterprise-installers</module>
    <module>xwiki-enterprise-ui</module>
    <module>xwiki-enterprise-web-dependencies</module>
    <module>xwiki-enterprise-web-legacydependencies</module>
    <module>xwiki-enterprise-web</module>
  </modules>
  <properties>
    <!-- Useful for Enterprise extensions -->
    <enterprise.version>${platform.version}</enterprise.version>

    <!-- The default UI -->
    <xwiki.extension.distribution.ui>org.xwiki.enterprise:xwiki-enterprise-ui-mainwiki</xwiki.extension.distribution.ui>
    <xwiki.extension.distribution.ui.version>${enterprise.version}</xwiki.extension.distribution.ui.version>
    <xwiki.extension.distribution.wikiui>org.xwiki.enterprise:xwiki-enterprise-ui-wiki</xwiki.extension.distribution.wikiui>
    <xwiki.extension.distribution.wikiui.version>${enterprise.version}</xwiki.extension.distribution.wikiui.version>

    <!-- Features -->
    <xe.distribution.features>
        ${platform.distribution.features},
        xwiki-enterprise
    </xe.distribution.features>

    <!-- xwiki.cfg configuration -->
    <!-- Default plugin list -->
    <xe.xwiki.cfg.plugins.default>${platform.xwiki.cfg.plugins.default},\
  com.xpn.xwiki.plugin.zipexplorer.ZipExplorerPlugin
    </xe.xwiki.cfg.plugins.default>
    <!-- Legacy plugin list -->
    <xe.xwiki.cfg.plugins.legacy>${platform.xwiki.cfg.plugins.legacy},\
  com.xpn.xwiki.plugin.zipexplorer.ZipExplorerPlugin
    </xe.xwiki.cfg.plugins.legacy>
    <xwiki.cfg.plugins.default>${xe.xwiki.cfg.plugins.default}</xwiki.cfg.plugins.default>
    <xwiki.cfg.plugins.legacy>${xe.xwiki.cfg.plugins.legacy}</xwiki.cfg.plugins.legacy>

    <!-- Module holding all WAR dependencies -->
    <war.dependencies.artifactId>xwiki-enterprise-web-dependencies</war.dependencies.artifactId>

    <!-- Defined as a property so that products extending XE can reuse this list -->
    <xe.ui.wiki.all.features>
      <!-- Embedded extensions -->
      org.xwiki.enterprise:xwiki-enterprise-ui,
      org.xwiki.enterprise:xwiki-enterprise-ui-wiki,
      org.xwiki.enterprise:xwiki-enterprise-ui-common,
      org.xwiki.platform:xwiki-platform-livetable-ui,
      org.xwiki.platform:xwiki-platform-index-ui,
      org.xwiki.platform:xwiki-platform-panels-ui,
      org.xwiki.platform:xwiki-platform-administration-ui,
      org.xwiki.platform:xwiki-platform-scheduler-ui,
      org.xwiki.platform:xwiki-platform-watchlist-ui,
      org.xwiki.platform:xwiki-platform-search-solr-ui,
      org.xwiki.platform:xwiki-platform-search-ui,
      org.xwiki.platform:xwiki-platform-office-ui,
      org.xwiki.platform:xwiki-platform-tag-ui,
      org.xwiki.platform:xwiki-platform-rendering-wikimacro-ui,
      org.xwiki.platform:xwiki-platform-annotation-ui,
      org.xwiki.platform:xwiki-platform-invitation-ui,
      org.xwiki.platform:xwiki-platform-extension-ui,
      org.xwiki.platform:xwiki-platform-sheet-ui,
      org.xwiki.platform:xwiki-platform-appwithinminutes-ui,
      org.xwiki.platform:xwiki-platform-linkchecker-ui,
      org.xwiki.platform:xwiki-platform-dashboard-ui,
      org.xwiki.platform:xwiki-platform-user-profile-ui,
      org.xwiki.platform:xwiki-platform-user-directory-ui,
      org.xwiki.platform:xwiki-platform-logging-ui,
      org.xwiki.platform:xwiki-platform-help-ui,
      org.xwiki.platform:xwiki-platform-uiextension-ui,
      org.xwiki.platform:xwiki-platform-activitystream-ui,
      org.xwiki.platform:xwiki-platform-messagestream-ui,
      org.xwiki.platform:xwiki-platform-sandbox,
      org.xwiki.platform:xwiki-platform-wysiwyg-ui,
      org.xwiki.platform:xwiki-platform-workspace-template-features,
      org.xwiki.enterprise:xwiki-enterprise-ui-all
    </xe.ui.wiki.all.features>

    <!-- Use CKEditor by default in XE -->
    <xwiki.properties.defaultWysiwygEditor>ckeditor</xwiki.properties.defaultWysiwygEditor>
  </properties>
  <!-- The 3rd party (contrib) extensions may depend on a version of XWiki Platform older than the version defined in
       this, so we might end up with old platform/rendering/commons JARs in the jetty/hsqldb packaging for example,
       instead of the version we want (Note that EM does not have the same way to deal with version collisions and gives
       priority to greater version instead of the one closer to the dependency tree root like Maven does so it should
       no be an issue when going through the DW).

       This  is why the following dependencies are manually managed, to force Maven to use the versions for them defined
       by platform and not the versions found transitively in the extension. -->
  <dependencyManagement>
    <dependencies>
      <!-- application-blog-ui -->
      <dependency>
        <groupId>org.xwiki.platform</groupId>
        <artifactId>xwiki-platform-notifications-api</artifactId>
        <version>${platform.version}</version>
      </dependency>
      <dependency>
        <groupId>org.xwiki.platform</groupId>
        <artifactId>xwiki-platform-eventstream</artifactId>
        <version>${platform.version}</version>
      </dependency>
      <!-- application-help-center -->
      <dependency>
        <groupId>org.xwiki.platform</groupId>
        <artifactId>xwiki-platform-icon-script</artifactId>
        <version>${platform.version}</version>
      </dependency>
      <dependency>
        <groupId>org.xwiki.platform</groupId>
        <artifactId>xwiki-platform-skin-skinx</artifactId>
        <version>${platform.version}</version>
      </dependency>
      <dependency>
        <groupId>org.xwiki.platform</groupId>
        <artifactId>xwiki-platform-rendering-wikimacro-store</artifactId>
        <version>${platform.version}</version>
      </dependency>
      <dependency>
        <groupId>org.xwiki.platform</groupId>
        <artifactId>xwiki-platform-administration-ui</artifactId>
        <version>${platform.version}</version>
        <type>xar</type>
      </dependency>
      <dependency>
        <groupId>org.xwiki.platform</groupId>
        <artifactId>xwiki-platform-extension-ui</artifactId>
        <version>${platform.version}</version>
        <type>xar</type>
      </dependency>
      <dependency>
        <groupId>org.xwiki.rendering</groupId>
        <artifactId>xwiki-rendering-macro-toc</artifactId>
        <version>${rendering.version}</version>
      </dependency>
      <dependency>
        <groupId>org.xwiki.platform</groupId>
        <artifactId>xwiki-platform-rendering-macro-gallery</artifactId>
        <version>${platform.version}</version>
      </dependency>
      <dependency>
        <groupId>org.xwiki.platform</groupId>
        <artifactId>xwiki-platform-chart-macro</artifactId>
        <version>${platform.version}</version>
      </dependency>
      <dependency>
        <groupId>org.xwiki.platform</groupId>
        <artifactId>xwiki-platform-index-tree-macro</artifactId>
        <version>${platform.version}</version>
        <type>xar</type>
      </dependency>
      <dependency>
        <groupId>org.xwiki.platform</groupId>
        <artifactId>xwiki-platform-index-ui</artifactId>
        <version>${platform.version}</version>
        <type>xar</type>
      </dependency>
      <dependency>
        <groupId>org.xwiki.platform</groupId>
        <artifactId>xwiki-platform-help-ui</artifactId>
        <version>${platform.version}</version>
        <type>xar</type>
      </dependency>
      <dependency>
        <groupId>org.xwiki.platform</groupId>
        <artifactId>xwiki-platform-activitystream-ui</artifactId>
        <version>${platform.version}</version>
        <type>xar</type>
      </dependency>
      <dependency>
        <groupId>org.xwiki.platform</groupId>
        <artifactId>xwiki-platform-sandbox</artifactId>
        <version>${platform.version}</version>
        <type>xar</type>
      </dependency>
      <dependency>
        <groupId>org.xwiki.platform</groupId>
        <artifactId>xwiki-platform-rendering-wikimacro-ui</artifactId>
        <version>${platform.version}</version>
        <type>xar</type>
      </dependency>
      <dependency>
        <groupId>org.xwiki.platform</groupId>
        <artifactId>xwiki-platform-rendering-macro-velocity</artifactId>
        <version>${platform.version}</version>
      </dependency>
      <dependency>
        <groupId>org.xwiki.platform</groupId>
        <artifactId>xwiki-platform-rendering-macro-include</artifactId>
        <version>${platform.version}</version>
      </dependency>
      <dependency>
        <groupId>org.xwiki.rendering</groupId>
        <artifactId>xwiki-rendering-macro-html</artifactId>
        <version>${rendering.version}</version>
      </dependency>
      <dependency>
        <groupId>org.xwiki.rendering</groupId>
        <artifactId>xwiki-rendering-macro-box</artifactId>
        <version>${rendering.version}</version>
      </dependency>
      <dependency>
        <groupId>org.xwiki.rendering</groupId>
        <artifactId>xwiki-rendering-macro-message</artifactId>
        <version>${rendering.version}</version>
      </dependency>
      <!-- application-tour-ui -->
      <dependency>
        <groupId>org.xwiki.platform</groupId>
        <artifactId>xwiki-platform-appwithinminutes-ui</artifactId>
        <version>${platform.version}</version>
        <type>xar</type>
      </dependency>
      <dependency>
        <groupId>org.xwiki.platform</groupId>
        <artifactId>xwiki-platform-security-script</artifactId>
        <version>${platform.version}</version>
      </dependency>
    </dependencies>
  </dependencyManagement>
  <build>
    <plugins>
      <plugin>
        <groupId>org.apache.maven.plugins</groupId>
        <artifactId>maven-enforcer-plugin</artifactId>
        <executions>
          <!-- Verify that all org.xwiki.commons dependencies have a version specified either as:
               - ${commons.version}
               - a value not starting with $ (we want to allow supporting ranges)
               Also verifies that all org.xwiki.rendering dependencies have a version specified either as:
               - ${rendering.version}
               - a value not starting with $ (we want to allow supporting ranges)
               Also verifies that all org.xwiki.platform dependencies have a version specified either as:
               - ${platform.version}
               - a value not starting with $ (we want to allow supporting ranges)
               Also verifies that all org.xwiki.enterprise dependencies have a version specified either as:
               - ${project.version}
               - a value not starting with $ (we want to allow supporting ranges)
          -->
          <execution>
            <id>check-dependency-version</id>
            <goals>
              <goal>enforce</goal>
            </goals>
            <configuration>
              <rules>
                <validateDependencyVersion implementation="org.xwiki.tool.enforcer.ValidateDependencyVersion">
                  <versionCheck>
                    <groupIdPrefix>org.xwiki.commons</groupIdPrefix>
                    <allowedVersionRegex>\$\{commons.version\}|[^$].*</allowedVersionRegex>
                  </versionCheck>
                  <versionCheck>
                    <groupIdPrefix>org.xwiki.rendering</groupIdPrefix>
                    <allowedVersionRegex>\$\{rendering.version\}|[^$].*</allowedVersionRegex>
                  </versionCheck>
                  <versionCheck>
                    <groupIdPrefix>org.xwiki.platform</groupIdPrefix>
                    <allowedVersionRegex>\$\{platform.version\}|[^$].*</allowedVersionRegex>
                  </versionCheck>
                  <versionCheck>
                    <groupIdPrefix>org.xwiki.enterprise</groupIdPrefix>
                    <allowedVersionRegex>\$\{project.version\}|[^$].*</allowedVersionRegex>
                  </versionCheck>
                </validateDependencyVersion>
              </rules>
            </configuration>
          </execution>
        </executions>
      </plugin>
    </plugins>
  </build>
  <profiles>
    <profile>
      <id>legacy</id>
      <properties>
        <!-- Set legacy dependencies -->
        <war.dependencies.artifactId>xwiki-enterprise-web-legacydependencies</war.dependencies.artifactId>
      </properties>
    </profile>
    <profile>
      <id>integration-tests</id>
      <modules>
        <module>xwiki-enterprise-test</module>
      </modules>
    </profile>
  </profiles>
</project>
